# 🚀 重新測試指南

## 📌 本次修正內容

### ✅ 已完成的改進
1. **server.py 升級為多線程版本**
   - `HTTPServer` → `ThreadingHTTPServer`
   - 請求隊列: 5 → 100
   - 守護線程模式: 啟用
   - 預期效果: 承受能力提升 5-10 倍

2. **server_defense.py 已是多線程**
   - 確認使用 `ThreadingHTTPServer`
   - 5 層防禦機制正常運作

---

## 🎯 重新測試步驟

### 方案 A: 快速驗證 (推薦)
測試無防禦伺服器的多線程改進是否有效

```powershell
# 終端1: 啟動無防禦伺服器
cd C:\Users\User\Desktop\Programm\topic\DDos
python server.py

# 終端2: 單獨測試無防禦伺服器
python progressive_test.py
# 選擇: [2] 僅測試單一伺服器
# 輸入端口: 8000
```

**預期結果**:
- ✅ 10 線程: 成功率 > 90%
- ✅ 20 線程: 成功率 > 80%
- ✅ 30 線程: 成功率 > 60%
- ⚠️ 50 線程: 開始卡頓

---

### 方案 B: 完整對比測試
比較有無防禦的效能差異

```powershell
# 終端1: 無防禦伺服器
python server.py

# 終端2: 有防禦伺服器
python server_defense.py

# 終端3: 對比測試
python progressive_test.py
# 選擇: [1] 完整對比測試
```

**預期結果**:
```
無防禦伺服器 (8000):
  10線程 → 🟢 正常 (原本 🔴 崩潰)
  20線程 → 🟡 輕微卡頓
  30線程 → 🔴 嚴重卡頓

有防禦伺服器 (8001):
  10線程 → 🟢 正常 (97%+)
  20線程 → 🟡 部分攔截 (50-70%)
  30線程 → 🔴 防禦觸發
```

---

### 方案 C: 分級攻擊測試
使用 quick_test.py 逐級測試

```powershell
# 啟動任一伺服器
python server.py  # 或 python server_defense.py

# 運行分級測試
python quick_test.py
```

**5 個測試級別**:
1. ⚡ 輕量級 (10 線程, 5 秒)
2. 🔥 中度攻擊 (30 線程, 10 秒)
3. 💥 高強度 (50 線程, 15 秒)
4. 🌋 極限壓力 (100 線程, 20 秒)
5. ☢️ 毀滅級 (200 線程, 30 秒)

---

### 方案 D: 高級攻擊方法測試
測試 7 種不同攻擊類型

```powershell
# 啟動伺服器
python server_defense.py

# 運行高級攻擊
python ddos_advanced.py
```

**7 種攻擊方法**:
1. HTTP GET Flood
2. HTTP POST Flood
3. Cache Bypass Attack
4. Header Bomb
5. Large Payload
6. TCP SYN Flood
7. Slowloris Attack

---

## 📊 測試檢查清單

### 測試前確認
- [ ] 確認 `server.py` 顯示 "多線程版"
- [ ] 確認隊列大小為 100
- [ ] 確認使用正確 IP: `10.1.208.170`
- [ ] 關閉其他占用端口的程序

### 測試中觀察
- [ ] 無防禦伺服器能處理 10+ 線程
- [ ] 有防禦伺服器能處理 20+ 線程
- [ ] 瀏覽器訪問能看到即時統計
- [ ] 終端顯示攔截日誌

### 測試後記錄
- [ ] 記錄最大穩定線程數
- [ ] 記錄崩潰臨界點
- [ ] 對比有無防禦的差異
- [ ] 檢查攔截日誌內容

---

## 🔍 除錯指南

### 問題 1: 無防禦伺服器仍然崩潰
```powershell
# 檢查是否使用多線程版本
python -c "from server import SilentHTTPServer; print(SilentHTTPServer.__bases__)"
# 應該顯示: (<class 'http.server.ThreadingHTTPServer'>,)
```

**解決方案**:
- 確認 `from http.server import ThreadingHTTPServer` 存在
- 確認 `class SilentHTTPServer(ThreadingHTTPServer):`

---

### 問題 2: 連接被拒絕 (Connection Refused)
```powershell
# 檢查端口是否被占用
netstat -ano | findstr "8000"
netstat -ano | findstr "8001"
```

**解決方案**:
```powershell
# 終止占用端口的進程
taskkill /PID <PID> /F
```

---

### 問題 3: IP 被黑名單封鎖
```powershell
# 訪問管理員端點清除黑名單
curl http://10.1.208.170:8001/admin/clear-blacklist
```

**解決方案**:
- 等待 30 秒自動解封
- 或訪問 `/admin/clear-blacklist` 立即清除

---

### 問題 4: 攻擊腳本無法連線
```python
# 檢查本地 IP
python get_ip.py
```

**解決方案**:
- 確認 IP 為 `10.1.208.170`
- 修改測試腳本中的目標 IP
- 檢查防火牆設置

---

## 📈 預期改進效果

### 無防禦伺服器 (server.py)
| 指標 | 修正前 | 修正後 (預期) | 提升 |
|------|--------|--------------|------|
| 10 線程成功率 | 0% | 95%+ | ∞ |
| 最大線程數 | 0 | 30-50 | ∞ |
| 平均延遲 | N/A | 50-100ms | - |
| 請求速率 | 0 | 100-200 req/s | ∞ |

### 有防禦伺服器 (server_defense.py)
| 指標 | 修正前 | 修正後 (預期) | 提升 |
|------|--------|--------------|------|
| 20 線程成功率 | 4% | 60-80% | 15-20x |
| 最大線程數 | 20 | 50-75 | 2.5-3.75x |
| 攔截率 | 96% | 40-60% | 持平 |
| 誤殺率 | 低 | 低 | 持平 |

---

## 🎯 測試目標

### 主要目標
1. ✅ 驗證無防禦伺服器不再瞬間崩潰
2. ✅ 確認多線程提升 5-10 倍承受能力
3. ✅ 對比有無防禦的實際差異

### 次要目標
1. 找出防禦伺服器的瓶頸
2. 測試不同攻擊方法的有效性
3. 優化防禦配置參數

---

## 💡 測試技巧

### 1. 漸進式測試
不要一次性使用最高線程數,逐步增加:
```
10 → 20 → 30 → 50 → 75 → 100 → 150 → 200
```

### 2. 觀察瀏覽器
在攻擊時打開瀏覽器訪問:
```
http://10.1.208.170:8000  # 觀察卡頓現象
http://10.1.208.170:8001  # 觀察防禦效果
```

### 3. 記錄臨界點
記錄以下數據:
- 開始卡頓的線程數
- 完全崩潰的線程數
- 成功率低於 30% 的線程數

### 4. 多次測試取平均
每個配置至少測試 3 次,避免偶然誤差

---

## 📝 測試報告模板

```markdown
## 測試日期: YYYY-MM-DD HH:MM

### 測試環境
- 無防禦伺服器版本: v2.1 (多線程)
- 有防禦伺服器版本: v2.0
- 測試工具: progressive_test.py
- 本地 IP: 10.1.208.170

### 無防禦伺服器測試 (8000)
| 線程 | 成功 | 失敗 | 成功率 | 延遲 | 速率 | 狀態 |
|------|------|------|--------|------|------|------|
| 10   |      |      |        |      |      |      |
| 20   |      |      |        |      |      |      |
| 30   |      |      |        |      |      |      |

### 有防禦伺服器測試 (8001)
| 線程 | 成功 | 失敗 | 成功率 | 延遲 | 速率 | 狀態 |
|------|------|------|--------|------|------|------|
| 10   |      |      |        |      |      |      |
| 20   |      |      |        |      |      |      |
| 30   |      |      |        |      |      |      |

### 結論
- 改進是否有效: [ ] 是 [ ] 否
- 無防禦最大線程數: ____
- 有防禦最大線程數: ____
- 防禦提升倍數: ____x
```

---

## 🚦 開始測試

選擇一個方案開始測試:

```powershell
# 推薦: 方案 A - 快速驗證
python server.py
# (新開終端) python progressive_test.py → 選 [2] → 輸入 8000
```

**測試完成後**:
- 將結果填入 `測試結果分析.md`
- 對比改進前後差異
- 決定是否需要進一步優化

---

**文件版本**: v1.0  
**最後更新**: 2025-11-20 11:50  
**作者**: GitHub Copilot
